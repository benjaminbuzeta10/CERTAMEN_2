{% extends 'base.html' %}

{% block title %}Dashboard Home - Shopping Trends{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4">
                <i class="bi bi-speedometer2"></i> Dashboard Principal
            </h1>
            <p class="lead text-muted">
                Sistema de Análisis de Tendencias de Compras
            </p>
        </div>
    </div>

    <!-- Estadísticas principales -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 card-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-2">
                                <i class="bi bi-people"></i> Total Clientes
                            </h6>
                            <h2 class="mb-0 text-primary fw-bold">
                                {{ total_customers }}
                            </h2>
                            <small class="text-success">
                                <i class="bi bi-arrow-up"></i> Activos en el sistema
                            </small>
                        </div>
                        <div class="bg-primary bg-opacity-10 rounded-circle p-3">
                            <i class="bi bi-people fs-1 text-primary"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'customers_list' %}" class="btn btn-sm btn-outline-primary w-100">
                        Ver todos los clientes <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 card-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-2">
                                <i class="bi bi-receipt"></i> Transacciones
                            </h6>
                            <h2 class="mb-0 text-success fw-bold">
                                {{ total_transactions }}
                            </h2>
                            <small class="text-info">
                                <i class="bi bi-graph-up"></i> Total registradas
                            </small>
                        </div>
                        <div class="bg-success bg-opacity-10 rounded-circle p-3">
                            <i class="bi bi-receipt fs-1 text-success"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'transactions_list' %}" class="btn btn-sm btn-outline-success w-100">
                        Ver transacciones <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 card-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted mb-2">
                                <i class="bi bi-box-seam"></i> Productos
                            </h6>
                            <h2 class="mb-0 text-warning fw-bold">
                                {{ total_products }}
                            </h2>
                            <small class="text-primary">
                                <i class="bi bi-collection"></i> En catálogo
                            </small>
                        </div>
                        <div class="bg-warning bg-opacity-10 rounded-circle p-3">
                            <i class="bi bi-box-seam fs-1 text-warning"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'products_list' %}" class="btn btn-sm btn-outline-warning w-100">
                        Ver productos <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones rápidas -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-gradient bg-primary text-white py-3">
                    <h5 class="mb-0">
                        <i class="bi bi-lightning-charge-fill"></i> Acciones Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a href="{% url 'data_management' %}" class="btn btn-lg btn-outline-primary w-100 py-3">
                                <i class="bi bi-database fs-3 d-block mb-2"></i>
                                Gestión de Datos
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'csv_upload' %}" class="btn btn-lg btn-outline-info w-100 py-3">
                                <i class="bi bi-file-earmark-arrow-up fs-3 d-block mb-2"></i>
                                Cargar CSV
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'customer_add' %}" class="btn btn-lg btn-outline-success w-100 py-3">
                                <i class="bi bi-person-plus fs-3 d-block mb-2"></i>
                                Nuevo Cliente
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'transaction_add' %}" class="btn btn-lg btn-outline-warning w-100 py-3">
                                <i class="bi bi-receipt-cutoff fs-3 d-block mb-2"></i>
                                Nueva Transacción
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos de Tendencias -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h3 mb-3">
                <i class="bi bi-bar-chart-line"></i>
                <span class="badge bg-gradient bg-success">Análisis y Visualizaciones</span>
            </h2>
            <p class="text-muted">
                Selecciona una visualización para explorar los datos en detalle
            </p>
        </div>
    </div>

    <div class="row g-4 mb-5">
        {% for grafico in graficos %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <a href="{% url grafico.url %}" class="text-decoration-none">
                <div class="card h-100 shadow-sm grafico-card border-top border-{{ grafico.color }} border-3">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <div class="chart-preview-container mb-3" data-url="{{ grafico.url }}" style="height: 100px; width: 100%; display: none;">
                            <canvas id="chart-{{ grafico.url }}"></canvas>
                        </div>
                        <div class="grafico-icono mb-3" id="icon-{{ grafico.url }}">
                            <div class="icon-circle bg-{{ grafico.color }} bg-opacity-10 mx-auto d-flex align-items-center justify-content-center" style="width: 70px; height: 70px; border-radius: 50%;">
                                <i class="bi bi-graph-up fs-1 text-{{ grafico.color }}"></i>
                            </div>
                        </div>
                        <h6 class="card-title text-{{ grafico.color }} fw-bold">
                            {{ grafico.titulo }}
                        </h6>
                        <p class="card-text text-muted small mb-0">
                            {{ grafico.descripcion }}
                        </p>
                    </div>
                    <div class="card-footer bg-{{ grafico.color }} bg-opacity-10 text-center border-0">
                        <small class="text-{{ grafico.color }} fw-bold">
                            <i class="bi bi-eye"></i> Ver análisis
                        </small>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- Información adicional -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-light">
                <div class="card-body text-center py-4">
                    <h5 class="mb-3">
                        <i class="bi bi-info-circle"></i> ¿Necesitas ayuda?
                    </h5>
                    <p class="text-muted mb-3">
                        Explora las visualizaciones para obtener insights sobre las tendencias de compra, o gestiona los datos directamente desde el panel de administración.
                    </p>
                    <div class="d-flex gap-2 justify-content-center">
                        <a href="{% url 'data_management' %}" class="btn btn-primary">
                            <i class="bi bi-gear"></i> Panel de Gestión
                        </a>
                        <a href="/admin/" class="btn btn-outline-secondary" target="_blank">
                            <i class="bi bi-shield-lock"></i> Admin Django
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .grafico-card {
        transition: all 0.3s ease;
        cursor: pointer;
        overflow: hidden;
    }

    .grafico-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
    }

    .grafico-icono {
        transition: transform 0.3s ease;
    }

    .grafico-card:hover .grafico-icono {
        transform: scale(1.1) rotate(5deg);
    }

    .card-hover {
        transition: all 0.3s ease;
    }

    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.15) !important;
    }

    a {
        color: inherit;
    }

    a:hover {
        color: inherit;
    }

    .badge {
        font-size: 1rem;
        padding: 0.5rem 1rem;
    }

    .display-4 {
        font-weight: 700;
        color: #2c3e50;
    }

    .lead {
        font-size: 1.1rem;
    }

    .icon-circle {
        transition: transform 0.3s ease;
    }

    .grafico-card:hover .icon-circle {
        transform: scale(1.15);
    }

    .bg-gradient {
        background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-info) 100%);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const previewData = {{ preview_data|safe }};
        
        // Iterate over all chart containers
        document.querySelectorAll('.chart-preview-container').forEach(container => {
            const url = container.dataset.url;
            
            if (previewData[url]) {
                // Show chart container and hide icon
                container.style.display = 'block';
                document.getElementById(`icon-${url}`).style.display = 'none';
                
                const ctx = document.getElementById(`chart-${url}`).getContext('2d');
                const chartInfo = previewData[url];
                
                // Determine color based on chart type/index or random
                const colors = [
                    'rgba(54, 162, 235, 0.6)',
                    'rgba(255, 99, 132, 0.6)',
                    'rgba(75, 192, 192, 0.6)',
                    'rgba(255, 206, 86, 0.6)'
                ];
                const color = colors[Math.floor(Math.random() * colors.length)];

                new Chart(ctx, {
                    type: chartInfo.type,
                    data: {
                        labels: chartInfo.labels,
                        datasets: [{
                            data: chartInfo.data,
                            backgroundColor: color,
                            borderColor: color.replace('0.6', '1'),
                            borderWidth: 1,
                            pointRadius: 0,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        indexAxis: chartInfo.indexAxis || 'x',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: false },
                            tooltip: { enabled: false }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        },
                        interaction: {
                            mode: 'none'
                        },
                        animation: {
                            duration: 0
                        }
                    }
                });
            }
        });
    });
</script>
{% endblock %}
